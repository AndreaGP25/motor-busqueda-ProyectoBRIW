<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultados para "{{ query }}"</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='results.css') }}">
</head>
<body>
    <div class="background-overlay"></div>

    <header class="top-bar">
        <div class="brand-container">
            <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="brand-name">BuscaBien</span>
        </div>
    </header>

    <main>
        <div class="search-box" id="main-box">
            <h1><a href="/" style="text-decoration: none;">Motor de Búsqueda</a></h1>
            <form action="/search" method="get" id="search-form">
                <div class="search-container">
                    <input type="text" name="q" value="{{ query }}" autocomplete="off" id="search-input">
                </div>

                <div class="controls">
                    <input type="submit" value="Buscar" id="btn-search">
                </div>
            </form>

            <div class="spell-check">
            {% if suggestion %}
            <p style="color:#0c0c0c; margin-bottom:15px;">
                ¿Quizás quisiste decir:
                <a href="/search?q={{ suggestion }}">{{ suggestion }}</a>?
            </p>
            {% endif %}
        </div>

        <div class="sinonimia">
            {% if semantica %}
            <p><strong>Búsqueda semántica activa:</strong> La consulta se expandió con sinónimos.</p>
        {% endif %}
        </div>

        <div class="info">
            Encontrados {{ total }} resultados para "{{ query }}"
        </div>


        <div class="layout">
            <div class="left">
                <h4>Filtrar por dominio</h4>
                <ul>
                {% for f in facetas_dom %}
                <li><a href="/search?q={{ query }}&fq=dominio_facet:{{ f.valor }}{% if semantica %}&semantica=on{% endif %}">
    {{ f.valor }} ({{ f.conteo }})</a></li>
                {% endfor %}
                </ul>

                <h4>Filtrar por año</h4>
                <ul>
                {% for f in facetas_anio %}
                <li><a href="/search?q={{ query }}&fq=anio:{{ f.valor }}{% if semantica %}&semantica=on{% endif %}">
    {{ f.valor }} ({{ f.conteo }})</a></li>
                {% endfor %}
                </ul>

                <h4>Tipo de contenido</h4>
                <ul>
                {% for f in facetas_tipo %}
                <li><a href="/search?q={{ query }}&fq=tipo_contenido:{{ f.valor }}{% if semantica %}&semantica=on{% endif %}">
    {{ f.valor }} ({{ f.conteo }})</a></li>
                {% endfor %}
                </ul>
            </div>

            <div class="right">
                {% for doc in documents %}
                <div class="result">
                    <a href="{{ doc.url }}" class="title">{{ doc.titulo }}</a>
                    <div class="url">{{ doc.url }}</div>
                    <div class="snippet">{{ doc.snippet | safe }}</div>

                    <div class="relevance-container">
                        <div class="relevance-info">
                            <span class="relevance-label {{ doc.relevance_class }}">
                                {{ doc.relevance_label }}
                            </span>
                            
                            <!-- Barra de progreso -->
                            <div class="relevance-bar">
                                <div class="relevance-fill {{ doc.relevance_class }}" 
                                    style="width: {{ doc.score_percentage }}%;">
                                </div>
                                <span class="relevance-text">{{ doc.score_percentage }}%</span>
                            </div>
                            
                            <!-- Score numérico -->
                            <div class="relevance-score">
                                Puntuación: <strong>{{ "%.2f"|format(doc.score) if doc.score else "N/A" }}</strong>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        </div>

        



        {% if total_pages > 1 %}
        <div class="pagination">
            {% for page_num in range(1, total_pages + 1) %}
                {% if page_num == current_page %}
                    <strong>{{ page_num }}</strong>
                {% else %}
                    <a href="/search?q={{ query }}&page={{ page_num }}{% if semantica %}&semantica=on{% endif %}">{{ page_num }}</a>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </main>

    
    <footer class="bottom-bar">
        <p>Proyecto Final • BRIW 2025</p>
        <p class="credits">Elaborado por: <b>Andrea Góngora</b>, <b>Mariana Caballero</b> y <b>Cristina Villanueva</b></p>
    </footer>
    
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>